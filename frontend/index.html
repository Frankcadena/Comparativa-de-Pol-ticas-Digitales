<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>DSS – Políticas Digitales (WDI)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="max-w-6xl mx-auto p-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">DSS – Evaluación Comparativa de Políticas Digitales</h1>
      <p class="text-sm text-gray-600">
        Fuente: World Bank <strong>WDI API (v2)</strong> ·
        <b>Uso</b>: <code>IT.NET.USER.ZS</code> ·
        <b>Infra fija</b>: <code>IT.NET.BBND.P2</code> ·
        <b>Capacidad</b>: <code>IT.NET.BNDW.PC</code>
      </p>
    </div>
    <button
      class="w-9 h-9 rounded-full bg-gray-800 text-white flex items-center justify-center shadow hover:opacity-90"
      title="Ayuda: escribe un país principal, países de referencia separados por comas y (opcional) un año. Luego presiona ‘Comparar (API)’ o carga un CSV/JSON.">
      ?
    </button>
  </header>

  <main class="max-w-6xl mx-auto p-6 grid gap-6">
    <!-- Controles -->
    <section id="controls" class="bg-white rounded-2xl p-4 shadow">
      <form id="form" class="grid md:grid-cols-4 gap-3 items-end" onsubmit="return false;">
        <div>
          <label class="block text-sm font-medium">Año (opcional)</label>
          <input id="year" type="number" min="1990" max="2100" class="mt-1 w-full border rounded-lg p-2" placeholder="2022" />
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium">País principal</label>
          <input id="countryMain" class="mt-1 w-full border rounded-lg p-2" placeholder="Colombia" list="dl-countries" />
        </div>
        <div>
          <label class="block text-sm font-medium">Países de referencia (coma)</label>
          <input id="countryRefs" class="mt-1 w-full border rounded-lg p-2" placeholder="Chile, México, España, Singapur" />
        </div>

        <div class="md:col-span-4 flex gap-3">
          <button id="btnApi" type="button" class="px-4 py-2 rounded-2xl bg-blue-600 text-white shadow">Comparar (API)</button>
          <label class="px-4 py-2 rounded-2xl bg-gray-900 text-white shadow cursor-pointer">
            Cargar archivo…
            <input id="file" type="file" class="hidden" accept=".csv,.json" />
          </label>
          <button id="btnClear" type="button" class="px-4 py-2 rounded-2xl bg-gray-200 shadow">Limpiar</button>
          <button id="btnCSV" type="button" class="px-4 py-2 rounded-2xl bg-amber-500 text-white shadow">Descargar CSV</button>
          <button id="btnReport" type="button" class="px-4 py-2 rounded-2xl bg-emerald-600 text-white shadow ml-auto">Descargar informe</button>
        </div>
      </form>

      <datalist id="dl-countries">
        <option value="Colombia"></option>
        <option value="Chile"></option>
        <option value="México"></option>
        <option value="España"></option>
        <option value="Singapur"></option>
      </datalist>

      <div id="chips" class="flex flex-wrap gap-2 mt-3 hidden"></div>
    </section>

    <!-- Estado vacío -->
    <section id="emptyState" class="bg-white rounded-2xl p-10 text-center shadow">
      <h2 class="text-xl font-semibold mb-2">Comienza tu comparación</h2>
      <p class="text-sm text-gray-600">
        Selecciona un país, agrega países de referencia y presiona <strong>Comparar (API)</strong>,<br/>
        o carga un archivo CSV/JSON.
      </p>
    </section>

    <!-- Síntesis -->
    <section id="sectionSynth" class="grid md:grid-cols-2 gap-6 hidden">
      <div class="bg-white rounded-2xl p-4 shadow">
        <h2 class="font-semibold mb-2 flex items-center gap-2">
          Radar – Uso / Infraestructura fija / Capacidad
          <span class="w-6 h-6 rounded-full bg-gray-200 text-center inline-flex items-center justify-center cursor-help"
                title="Radar (0–1): compara países en 3 ejes normalizados: Uso, Infraestructura fija y Capacidad. La escala se calcula con los países seleccionados.">?</span>
        </h2>
        <div class="h-96"><canvas id="radar"></canvas></div>
      </div>

      <div class="bg-white rounded-2xl p-4 shadow">
        <h2 class="font-semibold mb-2 flex items-center gap-2">
          Barras – Score global (0–1)
          <span class="w-6 h-6 rounded-full bg-gray-200 text-center inline-flex items-center justify-center cursor-help"
                title="Score global: promedio ponderado (pesos uniformes) de los ejes disponibles. Útil para ranking general.">?</span>
        </h2>
        <canvas id="bars"></canvas>
      </div>
    </section>

    <!-- Indicadores (valores brutos) -->
    <section id="sectionIndicators" class="bg-white rounded-2xl p-4 shadow hidden">
      <h2 class="font-semibold mb-4">Gráficas por indicador</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-medium mb-2 flex items-center gap-2">
            Infraestructura fija – Banda ancha por 100
            <span class="w-6 h-6 rounded-full bg-gray-200 text-center inline-flex items-center justify-center cursor-help"
                  title="Suscripciones de banda ancha fija por cada 100 habitantes (IT.NET.BBND.P2). Mayor es mejor.">?</span>
          </h3>
          <canvas id="chartAccessInfra"></canvas>
        </div>

        <div>
          <h3 class="font-medium mb-2 flex items-center gap-2">
            Uso – Usuarios de Internet (% personas)
            <span class="w-6 h-6 rounded-full bg-gray-200 text-center inline-flex items-center justify-center cursor-help"
                  title="Porcentaje de personas que usan Internet (IT.NET.USER.ZS). Mayor es mejor.">?</span>
          </h3>
          <canvas id="chartUse"></canvas>
        </div>

        <div class="md:col-span-2">
          <h3 class="font-medium mb-2 flex items-center gap-2">
            Capacidad – Ancho de banda intl. (Mbps/usuario)
            <span class="w-6 h-6 rounded-full bg-gray-200 text-center inline-flex items-center justify-center cursor-help"
                  title="Ancho de banda internacional por usuario (IT.NET.BNDW.PC) convertido a Mbps. Si falta, se usa banda ancha fija por 100 como proxy.">?</span>
          </h3>
          <canvas id="chartSpeed"></canvas>
          <p id="speedMsg" class="text-xs text-gray-500 mt-1"></p>
        </div>
      </div>
    </section>

    <!-- Hallazgos -->
    <section id="sectionInsights" class="bg-white rounded-2xl p-4 shadow hidden">
      <h2 class="font-semibold mb-2">Hallazgos</h2>
      <ul id="insights" class="list-disc pl-6 text-sm text-gray-700"></ul>
    </section>

    <!-- Detalle -->
    <section id="sectionDetail" class="bg-white rounded-2xl p-4 shadow hidden">
      <h2 class="font-semibold mb-2">Detalle (valores brutos, normalizados y pesos)</h2>
      <div class="overflow-auto">
        <table id="tbl" class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2">País</th>
              <th class="text-left p-2">Año</th>
              <th class="text-right p-2">Uso (%)</th>
              <th class="text-right p-2">Uso (norm)</th>
              <th class="text-right p-2">Infra fija (suscripciones/100)</th>
              <th class="text-right p-2">Infra (norm)</th>
              <th class="text-right p-2">Capacidad (Mbps/usuario)</th>
              <th class="text-right p-2">Capacidad (norm)</th>
              <th class="text-right p-2">Score</th>
            </tr>
          </thead>
          <tbody id="tblBody"></tbody>
        </table>
      </div>
      <p id="weightsText" class="text-xs text-gray-600 mt-2"></p>
    </section>

    <!-- Debug -->
    <section id="debug" class="bg-white rounded-2xl p-4 shadow hidden">
      <details>
        <summary class="cursor-pointer font-semibold">Debug (request + payload)</summary>
        <pre id="dbg" class="text-xs overflow-auto max-h-80 mt-2 bg-gray-50 p-2 rounded"></pre>
      </details>
    </section>
  </main>

  <script src="/js/app.js" defer></script>
</body>
</html>
